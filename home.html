<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Clean Tracker — Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-72.svg">
  <meta name="theme-color" content="#071227">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1220;
      --card: #071027;
      --muted: #9aa7bd;
      --accent1: #60a5fa;
      --accent2: #7dd3fc;
      --success: linear-gradient(90deg, var(--accent1), var(--accent2));
    }
    * { box-sizing: border-box; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    body { margin:0; background: linear-gradient(180deg, #020617, #071227); color:#e6eef8; min-height:100vh; }
    .wrap { max-width:1100px; margin:32px auto; padding:20px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    h1 { margin:0; font-weight:800; }
    .subtitle { color:var(--muted); font-size:13px; }
    .btn { background:var(--success); border:0; padding:8px 12px; border-radius:10px; color:#03212a; font-weight:600; cursor:pointer; }
    .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:16px; margin-top:18px; }
    .card { background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); }
    .card h3 { margin:0; font-size:18px; }
    .small { font-size:13px; color:var(--muted); }
    .progress { height:10px; background:rgba(255,255,255,0.05); border-radius:999px; overflow:hidden; margin-top:8px; }
    .bar { height:100%; background:var(--success); width:0; }
    .actions { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
    .empty { text-align:center; color:var(--muted); margin-top:24px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Clean Tracker</h1>
        <div class="subtitle">Your active challenges</div>
      </div>
      <a href="add.html"><button class="btn">+ New Challenge</button></a>
    </header>

    <div id="cards" class="grid"></div>
    <div id="empty" class="empty">No challenges yet. Create one to begin.</div>
  </div>

  <script>
    const KEY = 'ct_challenges_v1';
    function load(){ try{return JSON.parse(localStorage.getItem(KEY))||{challenges:{}};}catch(e){return{challenges:{}};} }
    function save(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

    function render(){
      const s = load();
      const cards = document.getElementById('cards');
      cards.innerHTML = '';
      const ids = Object.keys(s.challenges);
      document.getElementById('empty').style.display = ids.length ? 'none' : 'block';
      ids.forEach(id => {
        const c = s.challenges[id];
        const entries = c.entries || {};
        const clean = Object.values(entries).filter(v=>v.type==='clean').length;
        const pct = Math.min(100, Math.round(clean / c.days * 100) || 0);
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${c.name}</h3>
          <div class="small">Start: ${c.startDate} • ${c.days} days</div>
          <div class="progress"><div class="bar" style="width:${pct}%"></div></div>
          <div class="small">Clean ${clean}/${c.days} (${pct}%)</div>
          <div class="actions">
            <a href="challenge.html?id=${encodeURIComponent(id)}"><button class="btn">View</button></a>
            <button class="btn ghost" onclick="delChallenge('${id}')">Delete</button>
          </div>
        `;
        cards.appendChild(card);
      });
    }

    function delChallenge(id){
      if(!confirm('Delete this challenge?')) return;
      const s = load();
      delete s.challenges[id];
      save(s);
      render();
    }

    render();
  </script>
</body>
</html>
